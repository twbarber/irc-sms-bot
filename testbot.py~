import socket
import re
from googlevoice import Voice
from googlevoice.util import input

"""
    Uses pygooglevoice to send sms to list of numbers.
"""
def send_sms_message(contact):
   numbers = get_number_list()
   for i in numbers:
      phoneNumber = i
      text = ('Hi! I\'m the SUNY Potsdam Nerds Texting Bot.')
      voice.send_sms(phoneNumber, text)

""" 
    Reads server and login info in from config file...
    *** DO NOT PUSH THAT CONFIG FILE EVER YOU IDIOT ***
"""
def get_server_info():
    with open('server') as f:
        settings = f.read().splitlines()
        return settings

""" 
    Reads numbers from file...
    *** DO NOT PUSH THAT NUMBER FILE EVER YOU IDIOT ***
"""
def get_number_list():
    with open('nums') as f:
        numbers = f.read().splitlines()
        return numbers

# Populate vars with info needed to make connection
server_info = get_server_info()
server= server_info[0]
print server
port = int(server_info[1])
print port
channel = server_info[2]

# Connects to GVoice
voice = Voice()
voice_username = server_info[3]
voice_password = server_info[4]
voice.login(voice_username,voice_password,'')

# Connect to IRC
irc = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
irc.connect((server, port))
print irc.recv(4096)
irc.send ('NICK smsbot\r\n')
irc.send ('USER smsbot smsbot smsbot :Python IRC\r\n')
irc.send ('JOIN ' + channel +'\r\n')
irc.send ('PRIVMSG ' + channel + ' :Hello World.\r\n')
while True:
   data = irc.recv(4096)
   if data.find('PING') != -1:
      irc.send ('PONG ' + data.split() [1] + '\r\n')
   if data.find('hi botty') != -1:
      irc.send ('PRIVMSG ' + channel + ' :I already said hi...\r\n')
   if data.find('hello botty') != -1:
      irc.send ('PRIVMSG ' + channel + ' :I already said hi...\r\n')
   if data.find('KICK') != -1:
      irc.send ('JOIN ' + channel + '\r\n')
   if data.find('cheese') != -1:
      irc.send ('PRIVMSG ' + channel + ' :WHERE!!!!!!\r\n' )
   if data.find('sms') != -1:
      matches = re.search("sms (\w+)", data)
      if matches:
         send_sms_message(matches.group(1))
         irc.send ('PRIVMSG ' + channel + ' :Message Sent\r\n')
   print data 
   


